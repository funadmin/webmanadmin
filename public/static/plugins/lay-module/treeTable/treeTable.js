layui.define(["jquery"],function(a){var b="treeTable",c=layui.jquery,d=function(){};d.prototype.config=function(){return{init:null,top_value:0,primary_key:"id",parent_key:"pid",hide_class:"layui-hide",icon:{open:"layui-icon layui-icon-triangle-d",close:"layui-icon layui-icon-triangle-r",left:16},cols:[],checked:{},is_click_icon:!1,is_checkbox:!1,is_cache:!0}},d.prototype.template=function(a){var k,l,d=this,e=[],f="",g=c("table"+a.elem).length||!(a.is_click_icon=!0),h=a.is_checkbox?'<div class="layui-unselect layui-form-checkbox cbx" lay-skin="primary"><i class="layui-icon layui-icon-ok"></i></div>':"",i=h?h.replace("cbx","cbx layui-form-checked"):"",j=h&&'<th style="width:28px;">'+(c.inArray(a.top_value,a.checked.data)>-1?i:h)+"</th>";c.each(d.data(a,a.data),function(b,k){var o,l="",m=!1,n=k[a.parent_key]==a.top_value||k[a.parent_key]==d.cache(a,k[a.parent_key])?"":a.hide_class;k.level=e[k[a.primary_key]]=k[a.parent_key]!=a.top_value?e[k[a.parent_key]]+1:0,k.is_end=!a.childs[k[a.primary_key]],c.each(a.cols,function(f,n){var p,q,o="";cols[f][init]=a.init,n.width&&(o+="width:"+n.width+";"),n.align&&(o+="text-align:"+n.align+";"),o&&(o='style="'+o+'"'),a.is_checkbox&&a.checked&&c.inArray(k[a.checked.key],a.checked.data)>-1&&(m=!0),b||(j+="<th "+o+">"+n.title+"</th>"),p=n.key!=a.icon_key||k.is_end?"<span></span>":'<i class="'+(d.cache(a,k[a.primary_key])?a.icon.open:a.icon.close)+'"></i>',q=n.key==a.icon_key?e[k[a.primary_key]]*a.icon.left+"px":"",p=p.replace(">",' style="margin-left:'+q+';">'),l+="<td "+o+(q?"data-down":"")+">"+p+(g?"":m?i:h)+(n.template?n.template(k):k[n.key])+"</td>"}),o=g?c(m?i:h).wrap('<td style="width:28px;">').parent().prop("outerHTML"):"",f+='<tr class="'+n+'" data-id="'+k[a.primary_key]+'" data-pid="'+k[a.parent_key]+'">'+o+l+"</tr>"}),k=g?'<thead><tr data-id="'+a.top_value+'">'+j+"</tr></thead><tbody>"+f+"</tbody>":f.replace(/<tr/g,"<ul").replace(/tr>/g,"ul>").replace(/<td/g,"<li").replace(/td>/g,"li>"),l=a.is_click_icon?"[data-down] i:not(.layui-icon-ok)":"[data-down]",c(a.elem).html(k).off("click",l).on("click",l,function(){var e=c(this).parents("[data-id]"),f=e.find("[data-down]"),g=e.data("id"),h=e.data("pid"),i=f.find("i:not(.layui-icon-ok)").attr("class")==a.icon.close;i?(f.find("i:not(.layui-icon-ok)").attr("class",a.icon.open),f.parents(a.elem).find("[data-pid="+g+"]").removeClass(a.hide_class),d.cache(a,g,!0)):(f.find("i:not(.layui-icon-ok)").attr("class",a.icon.close),d.childs_hide(a,g)),layui.event.call(this,b,"tree(flex)",{elem:this,item:a.childs[h][g],table:a.elem,is_open:i})}).off("click",".cbx").on("click",".cbx",function(){var e=c(this).toggleClass("layui-form-checked").hasClass("layui-form-checked"),f=c(this).parents("[data-id]"),g=f.data("id"),h=f.data("pid");d.childs_checkbox(a,g,e),d.parents_checkbox(a,h),layui.event.call(this,b,"tree(box)",{elem:this,item:void 0===h?{}:a.childs[h][g],table:a.elem,is_checked:e})}).off("click","[lay-filter]").on("click","[lay-filter]",function(){var d=c(this).parents("[data-id]"),e=d.data("id"),f=d.data("pid"),g=c(this).attr("lay-filter");return layui.event.call(this,b,"tree("+g+")",{elem:this,item:a.childs[f][e]})}),a.end&&a.end(a)},d.prototype.parents_checkbox=function(a,b){var d=c(a.elem).find("[data-pid="+b+"]"),e=c(a.elem).find("[data-id="+b+"]"),f=c(a.elem).find("[data-pid="+b+"] .cbx.layui-form-checked").length;(d.length==f||0==f)&&(b=e.data("pid"),f?e.find(".cbx").addClass("layui-form-checked"):e.find(".cbx").removeClass("layui-form-checked"),void 0===b||this.parents_checkbox(a,b))},d.prototype.childs_checkbox=function(a,b,d){var e=this;c(a.elem).find("[data-pid="+b+"]").each(function(){var b=c(this).find(".cbx");d?b.addClass("layui-form-checked"):b.removeClass("layui-form-checked"),e.childs_checkbox(a,c(this).data("id"),d)})},d.prototype.childs_hide=function(a,b){var d=this;d.cache(a,b,!1),c(a.elem).find("[data-pid="+b+"]:not(."+a.hide_class+")").each(function(){var e=c(this).find("[data-down]"),f=e.find("i:not(.layui-icon-ok)");f.length&&f.attr("class",a.icon.close),e.parents(a.elem).find("[data-pid="+b+"]").addClass(a.hide_class),d.childs_hide(a,c(this).data("id"))})},d.prototype.data=function(a){var b=[],d=[];return c.each(a.data,function(c,e){b[e[a.primary_key]]=e,d[e[a.parent_key]]||(d[e[a.parent_key]]=[]),d[e[a.parent_key]][e[a.primary_key]]=e}),a.childs=d,this.tree_data(a,b,a.top_value,[])},d.prototype.tree_data=function(a,b,d,e){var f=this;return b[d]&&(e.push(b[d]),delete b[d]),c.each(a.data,function(c,g){g[a.parent_key]==d&&e.concat(f.tree_data(a,b,g[a.primary_key],e))}),e},d.prototype.render=function(a){var b=this;return a=c.extend(b.config(),a),a.url?c.get(a.url,function(c){a.data=c,b.template(a)}):b.template(a),a},d.prototype.checked=function(a){var b=[];return c(a.elem).find(".cbx.layui-form-checked").each(function(){var a=c(this).parents("[data-id]").data("id");b.push(a)}),b},d.prototype.openAll=function(a){var b=this;c.each(a.data,function(c,d){d[a.primary_key]&&b.cache(a,d[a.primary_key],!0)}),b.render(a)},d.prototype.closeAll=function(a){localStorage.setItem(a.elem.substr(1),""),this.render(a)},d.prototype.on=function(a,c){return layui.onevent.call(this,b,a,c)},d.prototype.cache=function(a,b,d){if(!a.is_cache)return!1;var f=a.elem.substr(1),b=b.toString(),g=localStorage.getItem(f)?localStorage.getItem(f).split(","):[],h=c.inArray(b,g);return void 0===d?-1==h?!1:b:(d&&-1==h&&g.push(b),!d&&h>-1&&g.splice(h,1),localStorage.setItem(f,g.join(",")),void 0)},d=new d,a(b,d)});